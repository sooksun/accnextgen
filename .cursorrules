# Cursor Rules สำหรับระบบบัญชีมินิมัล (Minimal Accounting)

## กติกาหลัก

1. **อ่าน context.md และ plan.md ทุกครั้งก่อนเริ่มทำงาน**
  - ให้ความสำคัญกับบริบทและแผนงานที่กำหนดไว้
  - ติดตาม tasks.md เพื่อดูงานที่ต้องทำ

2. **หลีกเลี่ยงการลบโค้ดเดิม**
  - ถ้ามีไฟล์อยู่แล้ว ให้อ่านและปรับปรุงต่อ
  - ใช้ search_replace หรือ edit แทนการเขียนทับทั้งหมด
  - เก็บโครงสร้างเดิมไว้ให้มากที่สุด

3. **ทำงานต่อเนื่องได้**
  - ถ้าถูกเรียกซ้ำ ให้ตรวจโครงสร้างโปรเจกต์ก่อน
  - "เติมส่วนที่ขาด" แทนการสร้างใหม่ทั้งหมด
  - เก็บสถานะการทำงานไว้ใน tasks.md

4. **ห้ามใช้ Mock Data นอก Database**
  - ข้อมูลหลักต้องอ่านจาก Prisma + MySQL
  - Demo data ใส่ใน prisma/seed.ts แล้วรัน seed
  - หลีกเลี่ยง hard-coded arrays ในโค้ด

5. **มาตรฐานโค้ด**
  - TypeScript ทั้งหมด (strict mode)
  - ใช้ Zod สำหรับ validation
  - ตรวจให้โค้ด compile ได้จริง
  - Decimal จาก Prisma ต้อง convert ด้วย Number() ก่อนใช้ใน calculations

6. **Database & ORM**
  - ใช้ Prisma เป็น ORM หลัก (MySQL/MariaDB)
  - Decimal fields ใช้ @db.Decimal(12,2)
  - ทุก mutation ต้องเช็ค Month Lock guard ก่อน

7. **Architecture (v2)**
  - **Next.js App Router** (single app, ไม่แยก backend)
  - API Routes อยู่ใน app/api/
  - Lib/Utilities อยู่ใน src/lib/
  - UI Components อยู่ใน components/
  - Document Templates อยู่ใน src/docTemplates/

8. **UI Framework**
  - Next.js 15+ App Router
  - TypeScript + TailwindCSS + shadcn/ui
  - Zod validation
  - ภาษาไทยเป็นหลัก (UI และข้อความ)
  - Responsive design

9. **Business Rules สำคัญ**
  - VAT 7% default: vatAmount = round(subTotal × vatRate/100, 2)
  - WHT (บริการ 3%): whtAmount = round(whtBase × whtRate/100, 2)
  - Month Lock: ปิดเดือนแล้วห้ามแก้ Document/Expense/Payment
  - P&L แยก Goods (orderId) vs Service (projectId)

10. **File Organization**
  - app/ → Pages + API Routes
  - components/ → React Components + shadcn/ui
  - src/lib/ → Shared utilities
  - src/docTemplates/ → PDF HTML templates
  - prisma/ → Schema + Seed

11. **การตอบสนอง**
  - ตอบเป็นภาษาไทย
  - อธิบายโค้ดและโครงสร้างให้ชัดเจน
  - ใช้ code references เมื่ออ้างอิงโค้ดเดิม
