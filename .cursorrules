# Cursor Rules สำหรับระบบบัญชีมินิมัล (Minimal Accounting)

# .cursorrules
# Global Cost Control Policy
# Applies to all projects

## 1) Default Model Policy
- Use fast/medium reasoning model as DEFAULT for all tasks.
- DO NOT use max-thinking / opus / deep-reasoning unless explicitly required.
- If the task is CRUD, UI scaffolding, DTO, schema draft, refactor, or file generation → use default model.

## 2) When Max-Thinking Is Allowed
Only use max-thinking if:
- Architecture tradeoff analysis is required.
- Complex schema/relationship redesign.
- Concurrency/transaction/race-condition debugging.
- Critical production bug with unclear root cause.

If unsure → ask whether deep reasoning is required before switching.

## 3) Token Discipline
- Keep responses concise unless explicitly asked for long explanation.
- Avoid generating unnecessary commentary or repeated code.
- Prefer incremental edits over full-file rewrites.
- Modify only the requested files; do not regenerate unrelated files.
- Avoid restating context that already exists in the conversation.

## 4) Edit Strategy
- Prefer patch-style changes over full file regeneration.
- If editing large files, only output the changed sections.
- Do not regenerate boilerplate unless specifically requested.

## 5) Feature Development Rule
- Build minimal vertical slice first (working path).
- Do not over-engineer beyond the requested scope.
- Avoid speculative abstractions unless clearly needed.

## 6) Guardrails
- Never auto-upgrade to a more expensive model silently.
- Never enable thinking mode unless the prompt requires deep reasoning.
- Always optimize for cost-efficiency unless explicitly told to prioritize maximum reasoning.

## 7) Clarification Before Escalation
If the task may require heavy reasoning:
- Briefly explain why.
- Ask for confirmation before switching to a higher-cost model.

Goal: Maximize output quality per token. Avoid unnecessary reasoning overhead.


## กติกาหลัก

1. **อ่าน context.md และ plan.md ทุกครั้งก่อนเริ่มทำงาน**
  - ให้ความสำคัญกับบริบทและแผนงานที่กำหนดไว้
  - ติดตาม tasks.md เพื่อดูงานที่ต้องทำ

2. **หลีกเลี่ยงการลบโค้ดเดิม**
  - ถ้ามีไฟล์อยู่แล้ว ให้อ่านและปรับปรุงต่อ
  - ใช้ search_replace หรือ edit แทนการเขียนทับทั้งหมด
  - เก็บโครงสร้างเดิมไว้ให้มากที่สุด

3. **ทำงานต่อเนื่องได้**
  - ถ้าถูกเรียกซ้ำ ให้ตรวจโครงสร้างโปรเจกต์ก่อน
  - "เติมส่วนที่ขาด" แทนการสร้างใหม่ทั้งหมด
  - เก็บสถานะการทำงานไว้ใน tasks.md

4. **ห้ามใช้ Mock Data นอก Database**
  - ข้อมูลหลักต้องอ่านจาก Prisma + MySQL
  - Demo data ใส่ใน prisma/seed.ts แล้วรัน seed
  - หลีกเลี่ยง hard-coded arrays ในโค้ด

5. **มาตรฐานโค้ด**
  - TypeScript ทั้งหมด (strict mode)
  - ใช้ Zod สำหรับ validation
  - ตรวจให้โค้ด compile ได้จริง
  - Decimal จาก Prisma ต้อง convert ด้วย Number() ก่อนใช้ใน calculations

6. **Database & ORM**
  - ใช้ Prisma เป็น ORM หลัก (MySQL/MariaDB)
  - Decimal fields ใช้ @db.Decimal(12,2)
  - ทุก mutation ต้องเช็ค Month Lock guard ก่อน

7. **Architecture (v2)**
  - **Next.js App Router** (single app, ไม่แยก backend)
  - API Routes อยู่ใน app/api/
  - Lib/Utilities อยู่ใน src/lib/
  - UI Components อยู่ใน components/
  - Document Templates อยู่ใน src/docTemplates/

8. **UI Framework**
  - Next.js 15+ App Router
  - TypeScript + TailwindCSS + shadcn/ui
  - Zod validation
  - ภาษาไทยเป็นหลัก (UI และข้อความ)
  - Responsive design

9. **Business Rules สำคัญ**
  - VAT 7% default: vatAmount = round(subTotal × vatRate/100, 2)
  - WHT (บริการ 3%): whtAmount = round(whtBase × whtRate/100, 2)
  - Month Lock: ปิดเดือนแล้วห้ามแก้ Document/Expense/Payment
  - P&L แยก Goods (orderId) vs Service (projectId)

10. **File Organization**
  - app/ → Pages + API Routes
  - components/ → React Components + shadcn/ui
  - src/lib/ → Shared utilities
  - src/docTemplates/ → PDF HTML templates
  - prisma/ → Schema + Seed

11. **การตอบสนอง**
  - ตอบเป็นภาษาไทย
  - อธิบายโค้ดและโครงสร้างให้ชัดเจน
  - ใช้ code references เมื่ออ้างอิงโค้ดเดิม
